<ion-header>
  <ion-toolbar>
    <ion-title>POS - Vendedor</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-card>
    <ion-card-header>
      <ion-card-title>Productos</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item button detail="false" *ngFor="let p of products" (click)="addToCart(p)">
          <ion-thumbnail slot="start" *ngIf="imgUrl(p.image_path)">
            <img [src]="imgUrl(p.image_path)!" />
          </ion-thumbnail>
          <ion-label>
            <h2>{{ p.nombre }}</h2>
            <p>$ {{ p.precio_venta }} | Stock: {{ p.stock_actual }}</p>
          </ion-label>
          <ion-badge slot="end">$ {{ p.precio_venta }}</ion-badge>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Carrito</ion-card-title>
    </ion-card-header>
    <ion-card-content>

      <ion-item *ngIf="cart.length === 0">
        <ion-label>Sin productos</ion-label>
      </ion-item>

      <ion-item *ngFor="let it of cart">
        <ion-label>
          <h2>{{ it.nombre }}</h2>
          <p>$ {{ it.precio_venta }} x {{ it.cantidad }} = ${{ (it.precio_venta * it.cantidad).toFixed(2) }}</p>
        </ion-label>

        <ion-button size="small" (click)="dec(it)">-</ion-button>
        <ion-button size="small" (click)="inc(it)">+</ion-button>
        <ion-button color="danger" size="small" (click)="remove(it)">X</ion-button>
      </ion-item>

      <ion-item lines="full">
        <ion-label><strong>Total</strong></ion-label>
        <ion-label slot="end"><strong>$ {{ total().toFixed(2) }}</strong></ion-label>
      </ion-item>

      <ion-item>
        <ion-label>Tipo venta</ion-label>
        <ion-segment [(ngModel)]="tipo_venta">
          <ion-segment-button value="local">Local</ion-segment-button>
          <ion-segment-button value="domicilio">Domicilio</ion-segment-button>
        </ion-segment>
      </ion-item>

      <ion-item>
        <ion-label>MÃ©todo pago</ion-label>
        <ion-select [(ngModel)]="metodo_pago_cliente">
          <ion-select-option value="efectivo">Efectivo</ion-select-option>
          <ion-select-option value="transferencia">Transferencia</ion-select-option>
          <ion-select-option value="tarjeta">Tarjeta</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item *ngIf="tipo_venta === 'domicilio'">
        <ion-label>Repartidor</ion-label>
        <ion-select [(ngModel)]="repartidor_id" placeholder="Selecciona repartidor">
          <ion-select-option *ngFor="let r of repartidores" [value]="r.user_id">
            {{ r.nombre }}
          </ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Notas</ion-label>
        <ion-textarea [(ngModel)]="notas" placeholder="Opcional"></ion-textarea>
      </ion-item>

      <ion-button expand="block" [disabled]="loading" (click)="createSale()">
        {{ loading ? 'Registrando...' : 'Registrar venta' }}
      </ion-button>

    </ion-card-content>
  </ion-card>

</ion-content>